(()=>{"use strict";document.addEventListener("DOMContentLoaded",function(){const e="https://www.cookie-banner.ca";let t=!1,n=null,o=null;const a=document.getElementById("login-section"),r=document.getElementById("signup-section"),c=document.getElementById("banner-builder"),i=document.getElementById("code-section"),s=document.getElementById("login-form"),l=document.getElementById("signup-form"),d=document.getElementById("show-signup"),u=document.getElementById("show-login"),m=document.getElementById("logout-btn"),y=document.getElementById("banner-title"),g=document.getElementById("banner-text"),f=document.getElementById("primary-color"),w=document.getElementById("text-color"),p=document.getElementById("accept-text"),h=document.getElementById("settings-text"),E=document.getElementById("banner-position"),v=document.getElementById("banner-preview"),b=document.getElementById("generated-code"),I=document.getElementById("generate-code"),S=document.getElementById("insert-banner"),B=document.getElementById("copy-code");function k(){t=!1,n=null,localStorage.removeItem("auth-token"),localStorage.removeItem("currentUser"),C()}function C(){x(),a?.classList.remove("hidden")}function L(){x(),c?.classList.remove("hidden")}function x(){[a,r,c,i].forEach(e=>{e?.classList.add("hidden")})}async function O(){var n;if(t)try{const t=localStorage.getItem("auth-token"),a=await fetch(`${e}/api/banners`,{headers:{Authorization:`Bearer ${t}`}});if(a.ok){const e=await a.json();e.length>0&&(o=e[0],n=o,y.value=n.title||"We use cookies",g.value=n.message||"We use cookies to enhance your browsing experience.",f.value=n.primaryColor||"#0073e6",w.value=n.textColor||"#ffffff",p.value=n.acceptButton||"Accept All",h.value=n.preferencesButton||"Cookie Settings",E.value=n.position||"bottom",$())}}catch(e){console.error("Error loading user banners:",e)}}function $(){if(!t)return;const e=y.value,n=g.value,o=f.value,a=w.value,r=p.value,c=h.value,i=v?.querySelector(".banner-content");if(i){i.style.backgroundColor=o,i.style.color=a;const t=i.querySelector("h4"),s=i.querySelector("p"),l=i.querySelector(".btn-accept"),d=i.querySelector(".btn-settings");t&&(t.textContent=e),s&&(s.textContent=n),l&&(l.textContent=r,l.style.backgroundColor=a,l.style.color=o),d&&(d.textContent=c,d.style.borderColor=a,d.style.color=a)}}function j(){return{title:y.value,message:g.value,primaryColor:f.value,textColor:w.value,acceptButton:p.value,preferencesButton:h.value,position:E.value,theme:"#ffffff"===f.value?"light":"dark"}}async function T(t){const n=localStorage.getItem("auth-token"),o=await fetch(`${e}/api/banners`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(t)});if(!o.ok)throw new Error("Failed to save banner configuration");const a=await o.json(),r=await fetch(`${e}/api/banners/${a.id}/code`,{headers:{Authorization:`Bearer ${n}`}});if(!r.ok)throw new Error("Failed to generate code");return(await r.json()).code}s.addEventListener("submit",async function(o){o.preventDefault();const a=document.getElementById("email").value,r=document.getElementById("password").value;try{await webflow.notify({type:"Info",message:"Signing you in..."});const o=await fetch(`${e}/api/auth/signin`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a,password:r})});if(!o.ok)throw new Error("Login failed");{const e=await o.json();n=e.user,t=!0,localStorage.setItem("auth-token",e.token),localStorage.setItem("currentUser",JSON.stringify(n)),L(),await O(),await webflow.notify({type:"Success",message:"Successfully logged in!"})}}catch(e){await webflow.notify({type:"Error",message:"Login failed. Please check your credentials."})}}),l.addEventListener("submit",async function(o){o.preventDefault();const a=document.getElementById("signup-name").value,r=document.getElementById("signup-email").value,c=document.getElementById("signup-password").value;try{await webflow.notify({type:"Info",message:"Creating your account..."});const o=await fetch(`${e}/api/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:a,email:r,password:c})});if(!o.ok)throw new Error("Signup failed");{const e=await o.json();n=e.user,t=!0,localStorage.setItem("auth-token",e.token),localStorage.setItem("currentUser",JSON.stringify(n)),L(),await webflow.notify({type:"Success",message:"Account created successfully!"})}}catch(e){await webflow.notify({type:"Error",message:"Signup failed. Please try again."})}}),d?.addEventListener("click",function(){x(),r?.classList.remove("hidden")}),u?.addEventListener("click",C),m?.addEventListener("click",k),[y,g,f,w,p,h,E].forEach(e=>e?.addEventListener("input",$)),I?.addEventListener("click",async function(){try{await webflow.notify({type:"Info",message:"Generating your banner code..."});const e=j(),t=await T(e);b&&(b.textContent=t),i?.classList.remove("hidden"),await webflow.notify({type:"Success",message:"Code generated successfully!"})}catch(e){await webflow.notify({type:"Error",message:"Failed to generate code. Please try again."})}}),S?.addEventListener("click",async function(){try{const e=await webflow.getSelectedElement();if(e&&e.textContent){const t=j(),n=await T(t);e.setTextContent(n),await webflow.notify({type:"Success",message:"Banner code inserted into selected element!"})}else await webflow.notify({type:"Error",message:"Please select a text element to insert the code."})}catch(e){await webflow.notify({type:"Error",message:"Failed to insert banner code."})}}),B?.addEventListener("click",async function(){try{b&&(await navigator.clipboard.writeText(b.textContent||""),await webflow.notify({type:"Success",message:"Code copied to clipboard!"}))}catch(e){await webflow.notify({type:"Error",message:"Failed to copy code."})}}),$(),function(){const e=localStorage.getItem("auth-token"),o=localStorage.getItem("currentUser");if(e&&o)try{n=JSON.parse(o),t=!0,L(),O()}catch(e){console.error("Error parsing user data:",e),k()}}()})})();